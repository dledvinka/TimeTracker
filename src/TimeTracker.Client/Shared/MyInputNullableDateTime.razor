@using System.Diagnostics.CodeAnalysis
@using System.Linq.Expressions
@inherits InputBase<DateTime?>

<div>

    @if (!string.IsNullOrEmpty(Label))
    {
        <label for="@Id" class="block text-s mt-2 font-medium text-gray-700">@Label</label>
    }

    <input type="@Type" id="@Id" @bind="@CurrentValueAsString" class="mt-1 p-2 w-full rounded-md border-gray-200 shadow-sm sm:text-sm" />
    <ValidationMessage For="@ValidationFor" class="text-xs text-red-600 font-bold my-1" />

</div>

@code {

    [Parameter] public string? Id { get; set; } = string.Empty;
    [Parameter] public string? Label { get; set; } = string.Empty;
    [Parameter] public string? Type { get; set; } = "datetime-local";
    [Parameter] public Expression<Func<DateTime?>> ValidationFor { get; set; } = default!;

    protected override bool TryParseValueFromString(string? value, [MaybeNullWhen(false)] out DateTime? result, [NotNullWhen(false)] out string? validationErrorMessage)
    {
        if (DateTime.TryParse(value, out var date))
        {
            result = date;
            validationErrorMessage = string.Empty;
            return true;
        }

        result = null;
        validationErrorMessage = "Invalid date format";

        return false;
    }

    protected override string? FormatValueAsString(DateTime? value)
    {
        return !value.HasValue ? string.Empty : value.Value.ToString("yyyy-MM-ddTHH:mm");
    }

}
